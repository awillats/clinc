![](/figures/core_figure_sketches/circuit_walkthrough_3circuits_annotated.png "generated by /code/network_analysis/fig_3circuit_walkthrough.py")
<!-- NOTE: see [CLINC - Figure Demo](https://docs.google.com/drawings/d/1OCqLHdHaLRi24GiD7XOSFU_7EoJ3gZxaVrFdsyMqlHM/edit) for figure composition, annotation -->


> **Figure DEMO : Applying CLINC to distinguish a trio of circuits.**
> ***(a)*** Connectivity for three different hypothesized circuits represented as a directed graph. This representation captures only the direct causal connections between nodes (also know as adjacency) and is what an experimenter may seek to infer from data.
> ***(b)*** Network reachability illustrates direct connection in black (as in *a*), but also the directional influence of indirect connections in grey. This representation forms the basis of predicting observed correlations, and the impact of interventions *(see Methods [# representations & reachability](REF-SECTION-HERE))*.
> ***(c)*** Pairwise correlations under passive observation. For these circuit hypotheses each node is connected directly or indirectly to each other node, leading to an all-to-all pattern of correlation which makes circuit identity difficult to distinguish.
> ***(d)*** Pairwise correlations under open-loop intervention at node B. Interventions can increase or decrease pairwise correlations (illustrated with thick and thin line weights) which provides some information about the directions of influence within a circuit.
> ***(e)*** Effective connectivity under closed-loop intervention at node B. Closed-loop control effectively lesions the inputs to the controlled node by driving that node to a specified target. This modifies the causal influences in the circuit (dashed dark arrows), and also interrupts any paths of indirect influence traveling through this node (illustrated with a red X over a dashed grey connection).
> ***(f)*** Pairwise correlations under closed-loop intervention at node B. As a result of the lesioned direct and indirect connections, resulting correlations are sparser and more distinct across hypotheses.

<!-- TODO: could use more lead-in. more reader engagement, more motivation -->
Consider the circuit identification problem shown in the `Figure DEMO`, in which an experimenter has identified three hypotheses for the causal structure of a three-node circuit. By quantifying pairwise measures of dependency, and comparing to the expected pattern produced under each hypothesis, this hypothesis set can be narrowed to only those consistent with the observed data. However, for some hypothesis sets and experimental conditions, several circuits may lead to equivalent pairwise correlations ( column (c), passive observation). Intervention may modify observed dependencies in a way which leads to more distinct outcomes, allowing the hypothesis set to be further reduced.
 
<!-- TODO: potentially suffering from sprinkling in *some* notation, without just writing it all here. -->
These circuit hypotheses, shown as directed graphs in  column (a), can each be represented by an adjacency matrix *(Methods [# reachability & representation](REF-SECTION-HERE))*. For example, circuit $C_1$ is represented by an adjacency matrix in which entries $w_{A→B}$, $w_{C→A}$, and $w_{C→B} \neq 0$. Note that hypotheses $C_1$ and $C_3$ have direct connections between nodes A and C. While hypothesis $C_2$ does not have a direct connection between these nodes an *indirect* connection exists through the path C $\to$ B $\to$ A *(shown as a solid gray arrow in  column (b))*. This indirect influence can be quantified and predicted using the the weighted reachability matrix $\widetilde{W}$ illustrated as a directed graph in  column (b).

Because there are direct or indirect connections between each pair of nodes, passive observation of each hypothesized circuit would reveal that all nodes are correlated with each other ( column (c)). These three hypotheses are therefore difficult to distinguish for an experimentalist who performs only passive observation. 
<!-- but can be distinguished through stimulation. -->
<!-- [^difficult-distinguish]: patterns are "difficult to distinguish" instead of "indistinguishable" here since the magnitudes of the correlations could also be informative with different assumptions -->

Open-loop stimulation is commonly applied to help understand the direction of causal influence in circuits. `Fig. DEMO,  column (d)` shows the impact on observed correlations of performing open-loop control on node B. In hypothesis $C_1$, node B is not a driver of other nodes, so open-loop stimulation at this site will introduce connection-independent noise which reduces its correlation with nodes which influence it. However, the connection from node B to A in hypotheses $C_2$ and $C_3$, leads to open-loop stimulation at node B to add shared variance between B and its downstream targets, and therefore *increases* the observed correlation between nodes B and A (see Methods [# intervention variance](REF-SECTION-HERE)). An experimenter can thus distinguish between hypothesis $C_1$ and the other two hypotheses by applying open-loop control and observing the resulting pattern of correlations (column (d)). However, this pattern of open-loop stimulation would not allow the experimenter to distinguish between hypotheses $C_2$ and $C_3$.

Closed-loop control (columns (e) and (f)) can provide the experimenter with even more inferential power. Column (e) shows the resulting adjacency matrix when closed-loop control is applied to node B. In each hypothesis, the result of this closed-loop control is to remove the impact of other nodes on node B. These severed connections are depicted in column (e) by dashed lines.<!-- when perfect closed-loop is applied the activity of node B is completely independent of other nodes.  --> Under hypothesis $C_2$, this also results in the elimination of the indirect connection from node C to node A. The application of closed-loop control at node B thus results in a different observed correlation structure in each of the three circuit hypotheses (column (f)). This means that the experimenter can therefore distinguish between these circuit hypotheses by applying closed-loop control, a result not possible with passive observation or open-loop control.

This example illustrates some key steps in circuit identification, and some of the differences in inferential power different interventional experiments provide. However, in the next section, we codify this process into a general set of steps or recipe for circuit inference. We then apply this approach more broadly to explore the impact of intervention in more detail.

<!-- 
NOTE: 
Overall thoughts 
raw material is there. but flips between talking about the general and the specific 

may introduce ideas in an ad-hoc way that is possibly redundant or even inconsistent with other sections 

the solution is to refactor this section, working from a big picture outline 
- what is the most distilled take away this section is trying to get across? 

This would also be the opportunity for engaging the reader more with a challenge / puzzle, along the lines of "try to figure out where to intervene!" 
although that's a little casual, and difficult to execute in a static format
-->




