![](figures/misc_figure_sketches/closed_loop_severs_inputs.png)
**Figure 11: Closed-loop control compensates for inputs to a node in simple circuits:** The left column shows a simple circuit and recording and stimulation sites for an open-loop experiment. The right column shows the functional circuit which results from closed-loop control of the output of region A. Generally, assuming perfectly effective control, the impact of other inputs to a controlled node is nullified and therefore crossed off the functional circuit diagram.

![](figures/misc_figure_sketches/closed_loop_distinguishes_corticalEI.png)
**Figure 12: Closed-loop control allows for two circuit hypotheses to be distinguished.** Two hypothesized circuits for the relationships between pyramidal (Pyr, excitatory), parvalbumin-positive (PV, inhibitory), and somatostain-expressing (Som, inhibitory) cells are shown in the two rows. Dashed lines in the right column represent connections whose effects are compensated for through closed-loop control of the Pyr node. By measuring correlations between recorded regions during closed-loop control it is possible to distinguish which hypothesized circuit better matches the data. Notably in the open-loop intervention, activity in all regions is correlated for both hypothesized circuits leading to ambiguity.

**Figure 13: Analysis of pairs of circuits under different levels of intervention.** 512 distinct circuits exist with 3 nodes. (LEFT) This matrix shows a comparison of pairs of these circuits. The color of each entry shows whether two circuits can be distinguished based on correlations from passive recordings alone (black, unambiguous class), from open loop stimulation (red, OL identifiable), from closing the loop around a single node (yellow, CL identifiable), or none of the above (white, ambiguous).(RIGHT) This pie chart shows the relative proportions of each class of ambiguity amongst the 512x512 pairs of 3-node circuits


## Significance (in EI circuits in cortex)
The reciprocal connectivity between excitatory and inhibitory subpopulations in sensory cortices make understanding functional relationships challenging under traditional open-loop experiments. In particular, identification of inhibitory connections remains especially challenging (Pastore et al. 2018) and yet many key functions in sensory systems are thought to mediated by inhibitory feedback circuits. Closed-loop approaches appear to be a promising solution to this challenge because they can hold regions constant, decoupling them from feedback pathways while maintaining naturalistic firing rate ranges. However, despite the increasing interest in closed-loop control from the systems neuroscience community, it is still poorly understood in which settings these approaches are useful and how they aid identification.
In aim 3, I will apply the estimation and control tools developed in aims 1 and 2 to better disentangle circuitry in a simple computational model of excitatory and inhibitory populations in sensory cortex. In doing so, I aim to leverage a novel modeling testbed to better characterize the types of scientific questions that can be asked and understood with burgeoning closed-loop technologies. This work is significant in pushing forward both the technological tools we have to control neural circuits, as well as in elucidating the utility of closed-loop methods for circuit identification.

## Hypothesis:
I hypothesize that we will be able to better recover the strength of connection between regions with closed-loop control experiments than connections inferred from open-loop stimulation alone. I hypothesize that this improved recovery is a result of closed-loop control suppressing noisy disturbances and better isolating confounding factors such as the inputs from other regions or state-dependent response properties which obscure causal relationships in open-loop experiments. In testing how closed-loop methods might enable us to distinguish between similar circuit models I will demonstrate, in simulation, how a circuit hypothesis could be tested in future in-vivo experiments. Specifically, I will simulate testing the hypothesis that somatostatin-expressing interneurons (Som, inhibitory) modulate pyramidal cells (Pyr, excitatory) directly rather than also indirectly, through parvalbumin interneurons (PV, inhibitory).

## proposed work
I aim to apply similar control and identification tools to estimate connectivity for two hypothesized models of cortical gain control. By comparing the estimated connectivity under two different simulated ground-truth conditions I aim to understand whether various stimulation and recording conditions are sufficient to distinguish these hypotheses. I anticipate that the effect of closed-loop control will be to functionally sever the inputs to the controlled region. This will be used to reversibly lesion the effect of Som cells on Pyr cells by controlling Pyr firing rates. If a correlation remains between Som and PV cells remains, then a direct link from Som cells to Pyr must exist (or an indirect link mediated by another uncontrolled population). Note that under passive observation, and even open-loop intervention, all three regions will display correlated activity, preventing these different hypotheses from being distinguished.  

The two computational studies above show small case studies from the wide range of potential circuit configurations, and therefore the range of possible identification experiments. To begin to explore the space of circuit identification experiments and the impact of closed-loop control more broadly, I computationally evaluated the ambiguity of all pairs of circuits with 3 nodes. By evaluating whether two circuits can be distinguished based on correlations from passive recordings alone (black, unambiguous class), from open loop stimulation (red, OL identifiable), from closing the loop around a single node (yellow, CL identifiable), or none of the above (white, ambiguous) I have started to outline which method of intervention is likely to be most useful for which circuit hypotheses.
 
# Reachability
To perform this evaluation, I used a simple derived quantity of the circuit’s adjacency matrix: its reachability (Skiena 2011). This quantity measures which nodes can be “reached” by direct and indirect connections starting from a target node. Moreover, this measure allows us to predict which node’s signals will be correlated. If the reachability of two circuits are equal, they will have similar correlational structure and be difficult to distinguish with that level of intervention. For instance looking at hypotheses for cortical gain control in open-loop (Figure 12, left column), in both circuit 2a and 2b, PV cells are reachable from the Som cell node since Som activity can influence PV activity indirectly through the Pyr node. As such these circuits cannot be distinguished in open loop.

If the reachability of two circuits are unequal for a given intervention, differences in correlation between observed regions will be sufficient to distinguish between the two hypotheses. Looking at these same circuits under closed-loop control of the pyramidal population (Figure 12, right column), dashed lines reveal that there is no longer an indirect functional connection from Som to PV cells. As such, in circuit 2a, PV cells are no longer reachable from the Som population, whereas they are reachable under circuit 2b. This difference in reachability corresponds to the difference in correlational structure that allows us to distinguish these two hypotheses under closed-loop control.

# Binary reachability sweep

In figure 13, I show the result of comparing reachability of all possible pairs of 3-node systems, effectively extending the process of the previous two case studies to many more possible experiments. These results show that for 3-node systems, only 28% of pairs of circuits can be distinguished from passive observation experiments. Open loop intervention is both necessary and sufficient to distinguish the majority (66%) of pairs of cells. 5% of circuit pairs require closed-loop intervention to be distinguished (the comparison in computational study 2 falls into this class), and 1% cannot be distinguished with closed-loop control of a single node.
It should be noted that this analysis represents a binary condition for identifiability based on simplified assumptions of circuit dynamics. As such closed-loop control is likely to provide improved data-efficiency and model recovery even for the large class of circuit pairs where open loop intervention is sufficient (the OL identifiable class). It should also be noted that hypothesized circuits within the brain are not uniformly distributed amongst all possible connectivity pattern (Song et al. 2005; Gal et al. 2019). 