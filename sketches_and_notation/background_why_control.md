# Closed-loop summary
For decades, engineers have used feedback control to actuate a system based on measured activity to reduce variability, compensate for imperfect measurements, drive systems to desired set points, and decouple connected systems. A growing community is developing and applying closed-loop stimulation strategies at the cellular and circuit level to understand the brain and treat disorders. The advent of optogenetic stimulation has accelerated the potential for effective closed-loop stimulation by facilitating actuation strategies that can be more precisely targeted and have minimal recording artifacts compared to conventional microelectrode stimulation. While many such new actuation and measurement tools have recently become available for neural systems, we require principled algorithmic tools for designing feedback controllers to use these neural interfaces. A gap still exists in making these tools modular, comprehensive, and straightforward to develop from prototype to final implementation. Alongside algorithmic advances, the neuroengineering community must also deepen its scientific understanding of how best to leverage these tools to more precisely answer questions of function in neural circuits. In this work my goals are to extend the framework for designing and implementing closed-loop control approaches, and to characterize how and why this framework can be used to identify tightly coupled neural circuits more effectively. 

# Closed-loop control is a powerful tool for therapeutic interventions and scientific discovery in neuroscience 

<details><summary>For decades, engineers have used feedback control to actuate a system based on measured activity to reduce variability, compensate for imperfect measurements, drive systems to desired set points, and decouple connected systems [...] </summary>

There is an increasing interest in using approaches from closed-loop control for neural stimulation to both study complex neural circuits and treat neurologic disorders. Recently, a growing community is developing and applying closed-loop stimulation strategies at the cellular and circuit level (Miranda-Dominguez, Gonia, and Netoff 2010; Santaniello, Burns, et al. 2011; Ching et al. 2013; Iolov, Ditlevsen, and Longtin 2014; Nandi, Kafashan, and Ching 2016; Bolus et al. 2018) to understand the brain (Packer et al. 2015) as well as treat disorders (Santaniello, Fiengo, et al. 2011; Paz et al. 2013; Ehrens, Sritharan, and Sarma 2015; Choi et al. 2016; Yang and Shanechi 2016; Kozák and Berényi 2017; Sorokin et al. 2017) The advent of optogenetic stimulation has accelerated the potential for effective closed-loop stimulation by providing actuation strategies that can be more precisely targeted and have minimal recording artifacts compared to conventional microelectrode stimulation (Grosenick, Marshel, and Deisseroth 2015)

Most applications of closed-loop control to neuroscience to date have used “activity-guided / responsive / triggered stimulation” wherein a predesigned stimulus is delivered in response to a detected event. For example, in (Krook-Magnuson et al. 2013) the authors detect seizure activity from spiking and local field potential features to trigger a pulse-train of inhibitory optogenetic stimulation which interrupts the seizure. While this is an effective approach for many applications, these types of closed-loop experiments should be distinguished from closed-loop with ongoing feedback such as dynamic clamp. In these feedback control approaches parameters of stimulation are adjusted on much faster timescales in response to measured activity. For dynamic clamp experiments, this low-latency ongoing feedback control allows experimenters to deliver currents which mimic virtual ion channels which would be implausible with triggered predesigned stimulation. These approaches provide additional precision in being able to drive activity patterns, but also come with increased algorithmic and hardware demands. For the rest of this document, we will use “closed-loop control” or “feedback control” to refer to this second, more specific class of approaches.
  
While many such new actuation and measurement tools have recently become available for neural systems, we require the development of principled algorithmic tools for designing feedback controllers to use these neural interfaces. Our collaborators have previously demonstrated successful closed-loop optogenetic control (CLOC) in-vitro (Newman et al. 2015) and in-vivo (Bolus et al. 2018) to track naturalistic, time-varying trajectories of firing rate. 
</details>

# Inference of causal relationships in neural circuits
- why causal?
- what's needed?
- how does closed-loop help?
<details><summary> click for more </summary>
Many hypotheses about neural circuits are best stated in terms of causal relationships: “Activity in this region causes an observed change in that downstream region. These regions are connected.” Furthermore, the development of effective therapeutic interventions requires knowledges of how potential therapies will change patient outcomes. However, for experiments without causal intervention, a key ambiguity remains as to whether observed outputs are caused by known/controlled inputs versus recurrent activity or unseen “confounds.” Historically causal interventions have been conducted through chemical and surgical lesion experiments to remove possible confounds; however, these are likely to dramatically disrupt circuits from their typical function. As such causal conclusions drawn from these experiments may no longer hold in naturalistic settings. 

What is necessary is to bolster the toolbox of causal methods for investigating neural circuits. To meet this need, we will need to draw from theory and methods of causal inference (Pearl 2009; Maathuis and Nandy 2016), and structural identifiability (Chis, Banga, and Balsa-Canto 2011) developed outside neuroscience. These fields have developed to answer questions about what classes of models can be distinguished under a given set of input output experiments, and what experiments are necessary to determine internal connections uniquely. Insights from structural identifiability will likely inform our approach for answering these questions about neural circuits but a significant gap remains in evaluating which techniques will be useful under the constraints and assumptions of systems neuroscience.

Second, carefully designed closed-loop control experiments have the potential to move from correlative to causal statements about neural circuits. We understand broadly that moving from experiments involving passive observation to more complex levels of intervention such as closed-loop control (Table 1) allows experimenters to better tackle challenges to circuit identification (Table 2). However, we do not yet fully understand which of these challenges can be overcome in neural circuits, nor how best to design these closed-loop interventions. What is needed is a foundational characterization of how closed-loop control improves identification in representative simulations of neural circuits. Such a characterization could be used to explore how closed-loop interventions can be designed to meet specific needs for different circuit motifs and noise levels. By integrating these approaches from control theory and causal inference with the domain-specific assumptions of neuroscience, it will be possible to guide effective closed-loop experiments and better uncover the connections which underly neural circuit function.
</details>


**Significance (in EI circuits in cortex)**
The reciprocal connectivity between excitatory and inhibitory subpopulations in sensory cortices make understanding functional relationships challenging under traditional open-loop experiments. In particular, identification of inhibitory connections remains especially challenging (Pastore et al. 2018) and yet many key functions in sensory systems are thought to mediated by inhibitory feedback circuits. Closed-loop approaches appear to be a promising solution to this challenge because they can hold regions constant, decoupling them from feedback pathways while maintaining naturalistic firing rate ranges. However, despite the increasing interest in closed-loop control from the systems neuroscience community, it is still poorly understood in which settings these approaches are useful and how they aid identification.
In aim 3, I will apply the estimation and control tools developed in aims 1 and 2 to better disentangle circuitry in a simple computational model of excitatory and inhibitory populations in sensory cortex. In doing so, I aim to leverage a novel modeling testbed to better characterize the types of scientific questions that can be asked and understood with burgeoning closed-loop technologies. This work is significant in pushing forward both the technological tools we have to control neural circuits, as well as in elucidating the utility of closed-loop methods for circuit identification.

**Hypothesis:**
I hypothesize that we will be able to better recover the strength of connection between regions with closed-loop control experiments than connections inferred from open-loop stimulation alone. I hypothesize that this improved recovery is a result of closed-loop control suppressing noisy disturbances and better isolating confounding factors such as the inputs from other regions or state-dependent response properties which obscure causal relationships in open-loop experiments. In testing how closed-loop methods might enable us to distinguish between similar circuit models I will demonstrate, in simulation, how a circuit hypothesis could be tested in future in-vivo experiments. Specifically, I will simulate testing the hypothesis that somatostatin-expressing interneurons (Som, inhibitory) modulate pyramidal cells (Pyr, excitatory) directly rather than also indirectly, through parvalbumin interneurons (PV, inhibitory).